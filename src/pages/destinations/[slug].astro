---
import { Image } from 'astro:assets';
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/layout/Header.astro';
import Footer from '../../components/layout/Footer.astro';
import destinationsData from '../../data/destinations.json';
import flightsData from '../../data/flights.json';
import type { Destination } from '../../types/destination';
import type { Flight } from '../../types/flight';

export async function getStaticPaths() {
	const destinations = destinationsData as Destination[];
	return destinations.map((destination) => ({
		params: { slug: destination.slug },
		props: { destination },
	}));
}

const { destination } = Astro.props as { destination: Destination };

// Find flights to this destination
const flights = (flightsData as Flight[]).filter((flight) =>
	destination.airports.includes(flight.destination.code)
);

// Get cheapest flight price
const cheapestPrice = flights.length > 0
	? Math.min(...flights.map((f) => f.classes.economy.price))
	: destination.starting_price;
---

<Layout
	title={`${destination.name}, ${destination.country} - AIT Airways`}
	description={destination.description}
>
	<Header />

	<main>
		{/* Hero Section */}
		<section class="relative h-[500px]">
			<div class="absolute inset-0">
				<Image
					src={destination.hero_image}
					alt={destination.name}
					width={1920}
					height={500}
					format="webp"
					quality={85}
					loading="eager"
					class="w-full h-full object-cover"
				/>
				<div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-black/20"></div>
			</div>

			<div class="relative h-full flex items-end">
				<div class="max-w-screen-xl mx-auto px-4 pb-12 w-full">
					<div class="max-w-3xl">
						<h1 class="text-5xl md:text-6xl font-bold text-white mb-4">
							{destination.name}
						</h1>
						<p class="text-2xl text-white/90 mb-6">
							{destination.country}
						</p>
						<p class="text-lg text-white/90">
							{destination.description}
						</p>
					</div>
				</div>
			</div>
		</section>

		{/* Quick Info Bar */}
		<section class="bg-white border-b border-gray-200 py-6">
			<div class="max-w-screen-xl mx-auto px-4">
				<div class="grid grid-cols-2 md:grid-cols-4 gap-6">
					<div class="text-center">
						<p class="text-3xl font-bold text-primary-600">${cheapestPrice}</p>
						<p class="text-sm text-gray-600">From (Economy)</p>
					</div>
					<div class="text-center">
						<p class="text-3xl font-bold text-primary-600">{destination.weekly_flights}</p>
						<p class="text-sm text-gray-600">Flights per Week</p>
					</div>
					<div class="text-center">
						<p class="text-3xl font-bold text-primary-600">{destination.flight_time}</p>
						<p class="text-sm text-gray-600">Flight Time</p>
					</div>
					<div class="text-center">
						<p class="text-3xl font-bold text-primary-600">{destination.best_time_to_visit}</p>
						<p class="text-sm text-gray-600">Best Time to Visit</p>
					</div>
				</div>
			</div>
		</section>

		{/* Main Content */}
		<section class="py-16 bg-gray-50">
			<div class="max-w-screen-xl mx-auto px-4">
				<div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
					{/* Left Column - Highlights */}
					<div class="lg:col-span-2">
						<h2 class="text-3xl font-bold text-gray-900 mb-6">
							Top Attractions
						</h2>
						<div class="bg-white rounded-xl shadow-md p-6 mb-8">
							<ul class="space-y-4">
								{destination.highlights.map((highlight) => (
									<li class="flex items-start gap-3">
										<svg class="w-6 h-6 text-primary-600 mt-1 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
											<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
										</svg>
										<span class="text-gray-700 text-lg">{highlight}</span>
									</li>
								))}
							</ul>
						</div>

						{/* About Destination */}
						<h2 class="text-3xl font-bold text-gray-900 mb-6">
							About {destination.name}
						</h2>
						<div class="bg-white rounded-xl shadow-md p-6 mb-8">
							<p class="text-gray-700 leading-relaxed mb-4">
								{destination.description}
							</p>
							<p class="text-gray-700 leading-relaxed">
								With {destination.weekly_flights} weekly flights and convenient schedules,
								{destination.name} is easily accessible from major cities worldwide.
								Whether you're traveling for business or leisure, our world-class service ensures
								your journey to {destination.name} is comfortable and memorable.
							</p>
						</div>

						{/* Airports Served */}
						<h2 class="text-3xl font-bold text-gray-900 mb-6">
							Airports We Serve
						</h2>
						<div class="bg-white rounded-xl shadow-md p-6">
							<div class="flex flex-wrap gap-3">
								{destination.airports.map((code) => (
									<span class="px-4 py-2 bg-primary-100 text-primary-700 font-semibold rounded-lg">
										{code}
									</span>
								))}
							</div>
						</div>
					</div>

					{/* Right Column - Booking Card */}
					<div class="lg:col-span-1">
						<div class="bg-white rounded-xl shadow-lg p-6 sticky top-24">
							<h3 class="text-2xl font-bold text-gray-900 mb-4">
								Book Your Flight
							</h3>

							<div class="mb-6">
								<p class="text-sm text-gray-600 mb-2">Prices starting from</p>
								<p class="text-4xl font-bold text-primary-600 mb-4">
									${cheapestPrice}
								</p>
								<p class="text-sm text-gray-600">
									{flights.length} flight{flights.length !== 1 ? 's' : ''} available
								</p>
							</div>

							<a
								href={`/book?destination=${destination.airports[0]} - ${destination.name}`}
								class="block w-full bg-primary-600 hover:bg-primary-700 text-white text-center font-semibold py-3 px-6 rounded-lg transition-colors mb-4"
							>
								Search Flights
							</a>

							<div class="border-t border-gray-200 pt-4 mt-4">
								<h4 class="font-semibold text-gray-900 mb-3">
									Why Book with Us?
								</h4>
								<ul class="space-y-2 text-sm text-gray-600">
									<li class="flex items-center gap-2">
										<svg class="w-4 h-4 text-green-600" fill="currentColor" viewBox="0 0 20 20">
											<path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
										</svg>
										Best price guarantee
									</li>
									<li class="flex items-center gap-2">
										<svg class="w-4 h-4 text-green-600" fill="currentColor" viewBox="0 0 20 20">
											<path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
										</svg>
										Flexible booking options
									</li>
									<li class="flex items-center gap-2">
										<svg class="w-4 h-4 text-green-600" fill="currentColor" viewBox="0 0 20 20">
											<path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
										</svg>
										24/7 customer support
									</li>
									<li class="flex items-center gap-2">
										<svg class="w-4 h-4 text-green-600" fill="currentColor" viewBox="0 0 20 20">
											<path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
										</svg>
										Earn miles & rewards
									</li>
								</ul>
							</div>
						</div>
					</div>
				</div>
			</div>
		</section>
	</main>

	<Footer />
</Layout>
